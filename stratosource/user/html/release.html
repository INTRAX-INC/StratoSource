
{% extends 'layout.html' %}

{% block breadcrumbs %}
<a href="/">Home</a> -> <a href="/releases">Manage Releases</a> -> Release {{ release.name }}
{% endblock %}

{% block jscript %}
    <script src="/csmedia/js/cs_release_management1.0.js" type="text/javascript"></script>
    <script src="/csmedia/js/cs_releases1.0.js" type="text/javascript"></script>
    <script type="text/javascript">
        // Return a helper with preserved width of cells
        var fixHelper = function(e, ui) {
            ui.children().each(function() {
                jQuery(this).width($(this).width());
            });
            return ui;
        };
         
        var updateHelper = function(e, ui) {
            alert('done! ' + jQuery("#sortable tbody").sortable( "toArray" ));
        };
        
        $(document).ready(function() {
            jQuery("#sortable tbody").sortable({
                helper: fixHelper,
                update: updateHelper
            }).disableSelection()
        });
    </script>
{% endblock %}

{% block content %}

    <div id="content" class="colMS">

        <div id="content-main">
            <form id="releaseNotes" name="releaseNotes" method="POST">{% csrf_token %}
                <div class="module">
                    <div class="section">
                            <span class="section">Release Notes</span>
                            <span class="sectionActions">
                                <a href="/manifest/{{release.id}}">Show Manifest</a>
                            </span>
                    </div>
                    <div style="padding: 10px;">
                        <textarea name="releaseNotes" cols="100" rows="5">{{ release.release_notes }}</textarea><br/>
                        <input type="button" onclick="document.getElementById('releaseNotes').submit(); return false;" value="Save Notes"/>
                    </div>
                </div>

                </div>
            </form>
            <div class="module ObjectsList">
                <table>
                    <caption>
                        <span class="section">Stories in {{ release.name }}</span>
                        <span class="sectionActions">
                            <a href="#" onclick="promptAddStories();">Add Stories</a>
                            {% if not release.released %}
                                 | <a href="#" onclick="markReleased('{{ release.id }}', '{{ release.name|addslashes }}', '{{ branch|addslashes }}', true);">Mark All Released</a>
                            {% endif %}
                        </span>
                    </caption>
                    <tr>
                        <th scope="row">ID</th>
                        <th>Name</th>
                        <th>Actions</th>
                    </tr>
                    {% for story in release.stories.all %}
                    <tr>
                        <td><a href="/instory/{{ story.id }}">{{story.rally_id}}</a></td>
                        <td>{{story.name}}</td>
                        <td>
                            {% if not release.released %}
                            <a onclick="if(!confirm('Are you sure you want to remove {{story.rally_id}} - \'{{story.name}}\'?')) return false;" href="?remove_story_id={{ story.id }}">Remove From Release</a>
                            {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="2">No Stories Added</td>
                    </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
        <br class="clear" />
    </div>
    <div style="display:none;">
        <div id="storyList" title="Story List" style="text-align: center;">
            <div>Please select the stories for adding:</div>
            <div>&nbsp;</div>
            <table align="center">
                <tr>
                    <td class="label">Stories:</td>
                    <td>&nbsp;&nbsp;</td>
                    <td>
                        <input id="release" name="release" type="hidden" value="{{ release.id }}"/>
                        <select name="storyId" id="storyId" size="10" multiple style="width:450px;">
                        {% for story in avail_stories %}
                            <option value="{{ story.id }}">{{ story.rally_id }} - {{ story.name }}</option>
                        {% endfor %}
                        </select>
                        <br/>
                        * Hold control key down to select multiple.
                    </td>
                </tr>
            </table>
        </div>
    </div>

{% endblock %}
